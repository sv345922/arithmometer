# arithmometer
@VladimirViSi (telegram)

Оркестратор хранит текущее состояние обработки в виде файла db.json, который подгружается
при каждом запросе c формированием рабочих структур в middleware, рабочая структура
(WorkingSpace) передается через контекст обработчикам

Вычислитель периодически отправляет запросы оркестратору для получения задачи, оркестратор
дает задачу из очереди задач (если она не пустая), устанавливая дедлайн в х1.5 времени выполнения
операции. Вычислитель вычисляет задачу и возвращает оркестратору результат.

Принимаемой выражение должно состоять из чередующихся последовательно чисел и операторов: )(+-*/
пробелы между символами могут присутствовать.
Первое число в выражении может быть отрицательным. 
В скобках первое число не должно быть отрицательным, в операторах умножения число 
не может быть отрицательным (проверить)

Выражение парсится по алгоритму Дейкстры, через постфиксную запись
в базе данных выражение сохраняется в виде списка символов в постфиксной записи.

Сервер работает по адресу _"localhost:8000"_
Выражение передается клиентом POST запросом по адресу
_http://127.0.0.1:8000/newexpression_
в теле запроса передается JSON со строкой выражения и таймингами операций в секундах
{
Expr:    "-1+(2-3)/4+5",
Timings: {"plus":1,"minus":1,"mult":1,"div":1},
}
клиенту возвращается id выражения

Клиент спрашивает о завершении расчетов передавая id выражения в Get запросе
получает ответ (результат или "ожидайте")
например 
_curl -v http://127.0.0.1:8000/getresult?id=146_

(в конце - id выражения(меняется))

Клиент, не зная id, не может получить ответ. 
! Любой клиент, который знает id, может получить ответ.

При первом запуске сервера - обязательно наличие базы данных в файле (приложена пустая бд))

Запускать все из папки arithmometer

#### Запуск сервера

_go run ./cmd/orch/_

#### Запуск вычислителя

_go run ./cmd/calculator/_

сколько раз запустишь, столько и будет вычислителей. Запускать либо в фоне, либо
в отдельных сеансах командной строки

#### Запуск клиента
для удобства тестирования сделан клиент.
_go run ./client/_
 Клиент первым параметром может принимать строку выражения



